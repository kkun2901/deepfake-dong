# Deepfake Detector App - Cursor 개발 가이드

## 프로젝트 개요
딥페이크 비디오와 오디오를 탐지하는 통합 애플리케이션입니다.
- **프론트엔드**: React Native + Expo (TypeScript)
- **백엔드**: Python FastAPI
- **네이티브**: Android (Kotlin) - 플로팅 위젯

## 프로젝트 구조
```
deepfake-detector-app-main/
├── backend/              # Python FastAPI 백엔드
│   ├── app/
│   │   ├── api/         # API 엔드포인트
│   │   ├── core/        # 설정 및 Firebase
│   │   ├── services/    # 비즈니스 로직 (딥페이크 탐지)
│   │   └── utils/       # 유틸리티
│   └── run_server.bat   # 서버 실행 스크립트
├── frontend/            # React Native Expo
│   ├── android/         # Android 네이티브 코드
│   │   └── app/src/main/java/com/anonymous/deepfakeapp/
│   │       └── FloatingService.kt  # 플로팅 위젯 서비스
│   ├── src/
│   │   ├── screens/     # 화면 컴포넌트
│   │   ├── components/  # 재사용 컴포넌트
│   │   ├── api/         # API 클라이언트
│   │   └── navigation/  # 네비게이션
│   └── package.json
└── requirements.txt     # Python 의존성
```

## 주요 기능
1. **비디오 딥페이크 탐지**: MesoNet 모델 사용
2. **오디오 딥페이크 탐지**: Whisper + Transformers
3. **Android 플로팅 위젯**: 화면 녹화 및 캡처 기능
4. **리포트 생성**: 분석 결과 PDF 리포트 생성

## 플로팅 위젯 상세 정보

### 현재 구현 상태
- **메인 버튼**: 60dp 크기, `camera_icon.png` 사용 (눈 모양 아이콘)
- **서브 버튼**: 50dp 크기
  - **녹화 버튼**: 상단 중앙, `icon_record.png`
  - **캡처 버튼**: 왼쪽 중앙, `icon_capture.png` (a.png에서 복사)
  - **종료 버튼**: 오른쪽 중앙, `icon_close.png` (c.png에서 복사)

### 아이콘 파일 위치
- `frontend/android/app/src/main/res/drawable/`
  - `camera_icon.png` - 메인 위젯 아이콘 (120dp 크기로 설정됨, 실제로는 60dp 사용)
  - `icon_capture.png` - 캡처 버튼 아이콘
  - `icon_close.png` - 종료 버튼 아이콘
  - `icon_record.png` - 녹화 버튼 아이콘

### FloatingService.kt 주요 기능
- `showFloatingWidget()`: 위젯 생성 및 표시
- `toggleMenu()`: 메뉴 버튼 표시/숨김
- `startScreenRecording()`: 화면 녹화 시작
- `stopScreenRecording()`: 화면 녹화 중지
- `captureFrame()`: 화면 캡처

### 버튼 레이아웃
- 메인 버튼: 중앙, 60dp
- 녹화 버튼: 상단 중앙, bottomMargin 80dp
- 캡처 버튼: 왼쪽 중앙, marginEnd 80dp
- 종료 버튼: 오른쪽 중앙, marginStart 80dp

## 개발 환경 설정

### 백엔드 실행
```bash
cd backend
.\run_server.bat
# 또는
venv\Scripts\activate
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000
```

### 프론트엔드 실행
```bash
cd frontend
npm install  # 처음 한 번만
npm start
```

### Android Studio에서 실행
1. Android Studio 열기
2. `frontend/android` 폴더 열기
3. 기기/에뮬레이터 선택 후 Run

## 코드 스타일 가이드

### Kotlin (Android)
- 파일: `FloatingService.kt`
- 패키지: `com.anonymous.deepfakeapp`
- 주요 클래스: `FloatingService : Service()`
- WindowManager를 사용한 오버레이 위젯 구현

### TypeScript/React Native
- 함수형 컴포넌트 사용
- TypeScript 타입 정의 필수
- API 호출은 `src/api/` 디렉토리에서 관리

### Python (FastAPI)
- FastAPI 라우터 패턴 사용
- 비동기 처리 (`async/await`)
- 타입 힌트 사용

## 주요 API 엔드포인트
- `POST /analyze-video` - 비디오 분석
- `GET /get-result/{video_id}` - 분석 결과 조회
- `POST /submit-report` - 리포트 제출
- `GET /download-report/{report_id}` - 리포트 다운로드

## 주의사항
1. `local.properties`는 Git에 포함되지 않음 (각 컴퓨터마다 자동 생성)
2. `firebase-key.json`은 보안상 Git에 포함되지 않음
3. 모델 가중치 파일(`*.h5`, `*.pth`)은 용량이 커서 Git에 포함되지 않음
4. `venv`는 각 컴퓨터에서 새로 생성해야 함

## 최근 변경사항
- 플로팅 위젯 메인 아이콘을 `camera_icon.png`로 변경
- 버튼 아이콘을 `a.png`(캡처), `c.png`(종료)로 변경
- 버튼 크기 조정: 메인 60dp, 서브 50dp
- 텍스트 레이블 제거 (아이콘만 사용)

## 개발 시 참고사항
- 위젯 크기 변경 시 `FloatingService.kt`의 `size` 변수 수정
- 아이콘 변경 시 `drawable` 폴더에 PNG 파일 추가 후 `getIdentifier()` 사용
- 버튼 위치 변경 시 `layoutParams`의 `gravity`와 `margin` 조정
- 메뉴 토글은 `toggleMenu()` 함수에서 `isExpanded` 상태로 관리

## 문제 해결
- 빌드 오류: `cd frontend/android && ./gradlew clean`
- Node 모듈 오류: `cd frontend && rm -rf node_modules && npm install`
- Python 가상환경 오류: `cd backend && rm -rf venv && python -m venv venv`

